{% extends '_layout.twig' %}

{% block title %}Welcome to Bethesda Ministry
{% endblock %}

{% block content %}
{% set entry = craft.entries().section('homepage').site(currentSite.handle).one() %}
  <section class="hero">
    <div class="hero-overlay"></div>
    <div class="hero-content">
      <h1>{{ entry.heroHeading }}</h1>
      <p>{{ entry.heroSubheading }}</p>
      <div class="hero-buttons">
        <a href="{{ url('prayer-room') }}" class="button primary">Visit Prayer Room</a>
        <a href="{{ url('sermons') }}" class="button primary">View Activities</a>
      </div>
    </div>
  </section>

  {# --- LATEST SERMONS --- #}
  {% if entry.showSermonsSection %}
  <section class="home-section">
      <h2>{{ entry.sermonSectionHeading }}</h2>
      <div class="home-grid">
        {% set upcomingSermons = craft.entries()
    .section('sermons')
    .sermonDate('>= ' ~ now|atom)
    .orderBy('sermonDate asc')
    .limit(entry.itemLimit)
    .all() %}

        {% for sermon in upcomingSermons %}
          <div class="home-card">
            {% set image = sermon.sermonImage.one() ?? null %}
            <img src="{{ image ? image.url : '/assets/default-placeholder.jpg' }}" alt="{{ sermon.title }}">
            <h3>{{ sermon.title }}</h3>
            <p>{{ sermon.sermonDescription|striptags|slice(0, 150) ~ '...' }}</p>
            <a href="{{ sermon.url }}" class="button">View Details</a>
          </div>
        {% endfor %}
      </div>
    </section>
  {% endif %}


  {# --- LATEST EVENTS --- #}
  {% if entry.showEventsSection %}
  <section class="home-section">
    <h2>{{ entry.eventSectionHeading }}</h2>
    <div class="home-grid">
      {% set upcomingEvents = craft.entries()
    .section('events')
    .eventDate('>= ' ~ now|atom)
    .orderBy('eventDate asc')
    .limit(3)
    .all() %}

      {% for event in upcomingEvents %}
        <div class="home-card">
          {% set image = event.eventImage.one() ?? null %}
          <img src="{{ image ? image.url : '/assets/default-placeholder.jpg' }}" alt="{{ event.title }}">
          <h3>{{ event.title }}</h3>
          <p>{{ event.eventDescription|striptags|slice(0, 150) ~ '...' }}</p>
          <a href="{{ event.url }}" class="button">View Details</a>
        </div>
      {% endfor %}
    </div>
  </section>
  {% endif %}

  {# --- LATEST ARTICLES --- #}
  {% set entry = craft.entries().section('homepage').one() %}

  {# --- LATEST ARTICLES --- #}
  {% if entry.showArticlesSection %}
  <section class="home-section">
    <h2>{{ entry.articleSectionHeading }}</h2>
    <div class="home-grid">
      {% set recentArticles = craft.entries()
    .section('articles')
    .orderBy('postDate desc')
    .limit(3)
    .all() %}

      {% for article in recentArticles %}
        <div class="home-card">
          {% set image = article.articleImage.one() ?? null %}
          <img src="{{ image ? image.url : '/assets/default-placeholder.jpg' }}" alt="{{ article.title }}">
          <h3>{{ article.title }}</h3>
          <p>{{ article.articleContent|striptags|slice(0, 150) ~ '...' }}</p>
          <a href="{{ article.url }}" class="button">Read More</a>
        </div>
      {% endfor %}
    </div>
  </section>
{% endif %}

{% endblock %}
